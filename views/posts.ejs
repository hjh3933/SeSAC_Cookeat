<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="description"
            content=" ë ˆì‹œí”¼ ëª©ë¡ì„ í‘œì‹œí•˜ë©°,
        ì‚¬ìš©ìê°€ ì œëª©, ë‚´ìš©, ë˜ëŠ” ì‘ì„±ì ê¸°ë°˜ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ê³¼ í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ëŠ¥ì´ ìˆìŒ"
        />
        <link rel="egg icon" href="/static/favicon.png" type="image/png" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://localhost:8080/" />
        <meta property="og:title" content="Cook! Eat!" />
        <meta property="og:image" content="/static/free-icon-fried-egg.png" />
        <meta property="og:description" content="ë‚˜ë§Œì˜ ë ˆì‹œí”¼ë¥¼ ìë‘í•´ë³´ì„¸ìš”!" />
        <meta property="og:site_name" content="Cook Eat" />
        <!-- ë‹¤ìŒì˜ íƒœê·¸ëŠ” í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ, í¬í•¨í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•¨ -->
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <title>ğŸ“Cook Eat Drawers</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous"
        />
        <!-- axios cdn -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <link rel="stylesheet" href="/css/bootstrap.min.css" />
        <link rel="stylesheet" href="/static/posts.css" />
        <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
        <%- include('nav.ejs') %> <%- include('footer.ejs') %> <%- include('account.ejs') %>
    </head>
    <body>
        <br />
        <% if(!isData){%>
        <p class="noData"><%=message %></p>

        <%} else{%>

        <section class="container">
            <h1 style="color: #495057"><%=pageTitle %></h1>
            <br />
            <form class="search-container">
                <select id="search-type">
                    <option value="title-content">ì œëª© + ë‚´ìš©</option>
                    <option value="author">ì‘ì„±ì</option>
                </select>
                <input type="text" id="search-bar" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”" />
                <a href="#"
                    ><img
                        class="search-icon"
                        src="http://www.endlessicons.com/wp-content/uploads/2012/12/search-icon.png"
                /></a>
            </form>
            <br />
            <table class="lists">
                <button
                    class="custom-btn btn-12"
                    onclick="location.href = '/post' "
                    style="justify-content: center"
                >
                    <span>Cook eat!ğŸ´</span><span>ìš”ë¦¬ì‹œì‘!ğŸ´</span>
                    <br />
                </button>
                <td class="total">ì´ ê²Œì‹œë¬¼: <%=totalPosts %></td>
                <thead>
                    <tr class="top">
                        <td class="items category">ì¹´í…Œê³ ë¦¬</td>
                        <td class="items postsTitle">ì œëª©</td>
                        <td class="items writer">ìš”ë¦¬ì‚¬</td>
                        <td class="items postsDate">ì‘ì„±ì¼ì</td>
                    </tr>
                </thead>

                <tbody>
                    <% for(let post of posts){ %>
                    <tr class="infomation">
                        <td class="infos postId"><%=post.id%></td>
                        <td class="infos id"><%=post.category%></td>
                        <td class="infos title">
                            <a href="/post/<%=post.postId%>"><%=post.title%></a>
                        </td>
                        <td class="infos User"><%=post.author.userName%></td>
                        <td class="infos createdAt"><%=post.dataValues.formattedDate%></td>
                    </tr>
                    <% } %>
                </tbody>
            </table>
            <br />
            <!-- pagination -->
            <nav aria-label="Page navigation" class="d-flex justify-content-center">
                <ul class="pagination">
                    <!-- ì´ì „ ë²„íŠ¼ -->
                    <% if (currentPage > 1) { %>
                    <li class="page-item">
                        <a
                            class="page-link"
                            href="/posts?page=<%= currentPage - 1 %>"
                            aria-label="Previous"
                        >
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <% } else { %>
                    <li class="page-item disabled">
                        <span class="page-link" aria-hidden="true">&laquo;</span>
                    </li>
                    <% } %>

                    <!-- í˜ì´ì§€ ë²„íŠ¼ë“¤ -->
                    <% for(let i = 1; i <= totalPages; i++) { %>
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                        <a class="page-link" href="/posts?page=<%= i %>"><%= i %></a>
                    </li>
                    <% } %>

                    <!-- ì´í›„ ë²„íŠ¼ -->
                    <% if (currentPage < totalPages) { %>
                    <li class="page-item">
                        <a
                            class="page-link"
                            href="/posts?page=<%= currentPage + 1 %>"
                            aria-label="Next"
                        >
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <% } else { %>
                    <li class="page-item disabled">
                        <span class="page-link" aria-hidden="true">&raquo;</span>
                    </li>
                    <% } %>
                </ul>
            </nav>
        </section>
        <% } %>
        <div class="space"></div>
        <footer>
            <script
                src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                crossorigin="anonymous"
            ></script>
            <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        </footer>
        <script>
            // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ë° ì—”í„° í‚¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
            document.querySelector(".search-icon").addEventListener("click", handleSearch);
            document.getElementById("search-bar").addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault(); // ê¸°ë³¸ ì—”í„° í‚¤ ë™ì‘ì„ ë°©ì§€
                    handleSearch();
                }
            });

            async function handleSearch() {
                // ê²€ìƒ‰ íƒ€ì…ê³¼ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
                const searchType = document.getElementById("search-type").value;
                const searchTerm = document.getElementById("search-bar").value;

                // ì˜µì…˜ ì„ íƒ ì—¬ë¶€ í™•ì¸
                if (!searchType) {
                    alert("ê²€ìƒ‰ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return; // ì˜µì…˜ì´ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê²€ìƒ‰ì„ ì¤‘ë‹¨
                }

                // ì„œë²„ì— ìš”ì²­ ë³´ë‚´ê¸°
                try {
                    if (searchType === "title-content") {
                        // ì œëª© + ë‚´ìš© ê²€ìƒ‰ ìš”ì²­
                        const response = await axios.get(`/searchResults?query=${searchTerm}`);
                        // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°›ì•˜ì„ ë•Œ ì²˜ë¦¬
                        // console.log(response.data);
                        // TODO: ì‘ë‹µì„ ê°€ì§€ê³  ë Œë”ë§ ë˜ëŠ” ë‹¤ë¥¸ ë™ì‘ ìˆ˜í–‰
                        window.location.href = `/searchResults?query=${searchTerm}`;
                    } else if (searchType === "author") {
                        // ì‘ì„±ì ê²€ìƒ‰ ìš”ì²­
                        const response = await axios.get(
                            `/searchResultsByAuthor?query=${searchTerm}`
                        );
                        // TODO: ì‘ë‹µì„ ê°€ì§€ê³  ë Œë”ë§ ë˜ëŠ” ë‹¤ë¥¸ ë™ì‘ ìˆ˜í–‰
                        window.location.href = `/searchResultsByAuthor?query=${searchTerm}&type=${searchType}`;
                    }
                    document.querySelector("h1").innerText = "ê²€ìƒ‰ ê²°ê³¼";
                } catch (error) {
                    // ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ ì²˜ë¦¬
                    console.error("ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:", error);
                    // TODO: ì˜¤ë¥˜ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
                }
            }
        </script>
    </body>
</html>
